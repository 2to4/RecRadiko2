# キーチェーンエラー解決ガイド

## エラー: "The specified item could not be found in the keychain"

このエラーは証明書やプロビジョニングプロファイルがキーチェーンに正しく保存されていない場合に発生します。

## 🔧 解決方法（推奨順）

### 方法1: キーチェーンのリセットと証明書の再生成

1. **キーチェーンアクセスを開く**
   ```bash
   open /Applications/Utilities/Keychain\ Access.app
   ```

2. **古い証明書を削除**
   - 左側で「ログイン」キーチェーンを選択
   - カテゴリで「証明書」を選択
   - 「Apple Development」で始まる証明書を探す
   - 古い/期限切れの証明書を右クリック → 削除

3. **Xcodeで証明書を再生成**
   - Xcode → Settings → Accounts
   - Apple IDを選択 → 「Manage Certificates...」
   - 左下の「+」→「Apple Development」
   - 新しい証明書が作成される

### 方法2: キーチェーンのロック解除

1. **キーチェーンアクセスで確認**
   ```bash
   # キーチェーンのロック状態確認
   security show-keychain-info ~/Library/Keychains/login.keychain-db
   ```

2. **ロックされている場合は解除**
   ```bash
   # キーチェーンのロック解除
   security unlock-keychain ~/Library/Keychains/login.keychain-db
   # パスワードを入力
   ```

### 方法3: Xcodeの設定リセット

1. **Derived Dataを削除**
   ```bash
   rm -rf ~/Library/Developer/Xcode/DerivedData/*
   ```

2. **プロジェクトをクリーン**
   ```bash
   # Xcodeで実行
   ⌘+Shift+K (Command+Shift+K)
   
   # またはターミナルで
   xcodebuild clean -project RecRadiko2.xcodeproj -scheme RecRadiko2
   ```

3. **Xcodeを再起動**

### 方法4: 証明書の完全リセット

1. **Xcodeのアカウントを削除して再追加**
   - Xcode → Settings → Accounts
   - Apple IDを選択 → 「-」ボタンで削除
   - 「+」ボタン → Apple IDで再ログイン

2. **プロジェクト設定を更新**
   - プロジェクト設定 → Signing & Capabilities
   - 「Automatically manage signing」を一度オフ→オン
   - Teamを再選択

### 方法5: コマンドラインでの証明書確認と修復

```bash
# 1. 現在の証明書を確認
security find-identity -v -p codesigning

# 2. 信頼設定をリセット
security trust-settings-remove -d "Apple Development"

# 3. キーチェーンの修復
security verify-cert -c "Apple Development"
```

## 🚨 それでも解決しない場合

### 開発用の一時的な回避策

```bash
# コード署名を無効化してビルド（開発時のみ）
xcodebuild build -project RecRadiko2.xcodeproj -scheme RecRadiko2 \
  CODE_SIGNING_REQUIRED=NO \
  CODE_SIGN_IDENTITY="" \
  CODE_SIGNING_ALLOWED=NO

# テスト実行（署名なし）
xcodebuild test -project RecRadiko2.xcodeproj -scheme RecRadiko2 \
  -destination 'platform=macOS' \
  CODE_SIGNING_REQUIRED=NO \
  CODE_SIGN_IDENTITY="" \
  CODE_SIGNING_ALLOWED=NO
```

### Xcodeプロジェクト設定での回避

1. RecRadiko2ターゲット → Build Settings
2. 検索バーで「Code Signing」を検索
3. 以下を設定（開発時のみ）：
   - Code Signing Identity → 「Don't Code Sign」
   - Code Signing Style → 「Manual」
   - Development Team → 「None」

## ✅ 推奨される解決手順

1. **まず方法1を試す**（多くの場合これで解決）
2. 解決しない場合は**方法2→3→4**の順に試す
3. 急ぎの開発作業の場合は**一時的な回避策**を使用
4. 後日、証明書の問題を根本的に解決

## 📝 予防策

- 定期的にキーチェーンアクセスで古い証明書を削除
- Xcodeのアップデート後は証明書の再生成を検討
- 複数のMacで開発する場合は証明書のエクスポート/インポートを使用

## 🔍 詳細なトラブルシューティング

エラーメッセージに含まれる情報から原因を特定：

```bash
# コンソールログを確認
log show --predicate 'subsystem == "com.apple.security"' --last 1h

# 証明書の詳細情報を表示
security find-certificate -a -p ~/Library/Keychains/login.keychain-db | \
  openssl x509 -text -noout
```